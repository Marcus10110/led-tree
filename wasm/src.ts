interface Vector<T> {
  size: () => number;
  get: (i: number) => T;
  set: (i: number, val: T) => void;
  push_back: (val: T) => void;
  resize: (size: number, val: T) => void;
  delete: () => void;
}

const vectorToList = <T>(vec: Vector<T>): T[] => {
  const count = vec.size();
  const list = [];
  for (let i = 0; i < count; ++i) {
    list.push(vec.get(i));
  }
  return list;
};

interface Color {
  r: number;
  g: number;
  b: number;
}

interface WasmModule {
  addOnPostRun: (fn: () => void) => void;
  Sum: (a: number, b: number) => number;
  AnimationCount: () => number;
  Render: (animation_id: number, strip_id: number, time_ms: number, led_count: number) => Vector<Color>;
}

declare var Module: WasmModule;

let animationIndex = 0;

Module.addOnPostRun(() => {
  console.log('addOnPostRun - script');
  console.log(Module);
  console.log(Module.Sum(1, 3));
  const startMs = new Date().getTime();

  const animationCount = Module.AnimationCount();
  const buttonList = document.getElementById('animationButtons');
  if (!buttonList) throw Error('button list not found');
  for (let i = 0; i < animationCount; ++i) {
    const button = document.createElement('button');
    button.innerText = `${i}`;
    const iCopy = i;
    button.addEventListener('click', () => (animationIndex = iCopy));
    buttonList.appendChild(button);
  }

  setInterval(() => {
    let stripIndex = 0;
    const ms = Math.round(new Date().getTime() - startMs);
    for (const strip of strips) {
      if (stripIndex === 11) {
        stripIndex++;
        continue;
      }
      const ledCount = strip.length;
      const colorVector = Module.Render(animationIndex, stripIndex, ms, ledCount);
      const colors = vectorToList(colorVector);
      colorVector.delete();
      const stripIndexLocal = stripIndex; // not needed, but makes the linter happy. closures....
      colors.forEach((color, index) => updateLed(stripIndexLocal, index, color));
      stripIndex++;
    }
  }, 1000 / 30);
});

function componentToHex(c: number) {
  var hex = c.toString(16);
  return hex.length == 1 ? '0' + hex : hex;
}

function rgbToHex(color: Color) {
  return '#' + componentToHex(color.r) + componentToHex(color.g) + componentToHex(color.b);
}

const intervtedStrips: number[] = [0, 2];

const updateLed = (strip: number, index: number, color: Color) => {
  if (intervtedStrips.includes(strip)) {
    const ledCount = strips[strip].length;
    index = ledCount - index - 1;
  }
  const ledId = `strip_${strip}_led_${index}`;
  const container = document.getElementById('ledArea');
  if (!container) throw Error('unable to find main div');
  let match = document.getElementById(ledId);
  if (!match) {
    // lazy add LED
    const led = document.createElement('div');
    led.className = 'led';
    led.id = ledId;
    const location = strips[strip][index];
    const mappedLocation = mapPosition(location.x, location.y);
    led.style.left = mappedLocation.left;
    led.style.top = mappedLocation.top;
    container.appendChild(led);
    match = led;
  }
  match.style.backgroundColor = rgbToHex(color);
};

const strips = [
  [
    { x: 0, y: 0 },
    { x: -1.3123, y: 0 },
    { x: -2.6246, y: 0 },
    { x: -3.9369, y: 0 },
    { x: -5.2492, y: 0 },
    { x: -6.5615000000000006, y: 0 },
    { x: -7.873800000000001, y: 0 },
    { x: -9.186100000000001, y: 0 },
    { x: -10.498400000000002, y: 0 },
    { x: -11.810700000000002, y: 0 },
    { x: -13.123000000000003, y: 0 },
    { x: -14.435300000000003, y: 0 },
    { x: -15.747600000000004, y: 0 },
    { x: -17.059900000000003, y: 0 },
    { x: -18.372200000000003, y: 0 },
    { x: -19.684500000000003, y: 0 },
    { x: -20.996800000000004, y: 0 },
    { x: -22.309100000000004, y: 0 },
    { x: -23.621400000000005, y: 0 },
    { x: -24.933700000000005, y: 0 },
    { x: -26.246000000000006, y: 0 },
    { x: -27.558300000000006, y: 0 },
    { x: -28.870600000000007, y: 0 },
    { x: -30.182900000000007, y: 0 },
    { x: -31.495200000000008, y: 0 },
    { x: -32.807500000000005, y: 0 },
    { x: -34.119800000000005, y: 0 },
    { x: -35.432100000000005, y: 0 },
    { x: -36.744400000000006, y: 0 },
    { x: -38.056700000000006, y: 0 },
    { x: -39.36900000000001, y: 0 },
    { x: -40.68130000000001, y: 0 },
    { x: -41.99360000000001, y: 0 },
    { x: -43.30590000000001, y: 0 },
    { x: -44.61820000000001, y: 0 },
    { x: -45.93050000000001, y: 0 },
    { x: -47.24280000000001, y: 0 },
    { x: -48.55510000000001, y: 0 },
    { x: -49.86740000000001, y: 0 },
    { x: -51.17970000000001, y: 0 },
    { x: -52.49200000000001, y: 0 },
    { x: -53.80430000000001, y: 0 },
    { x: -55.11660000000001, y: 0 },
    { x: -56.42890000000001, y: 0 },
    { x: -57.74120000000001, y: 0 },
    { x: -59.053500000000014, y: 0 },
    { x: -60.365800000000014, y: 0 },
    { x: -61.678100000000015, y: 0 },
    { x: -62.990400000000015, y: 0 },
    { x: -64.30270000000002, y: 0 },
    { x: -65.61500000000001, y: 0 },
    { x: -66.9273, y: 0 },
    { x: -68.2396, y: 0 },
    { x: -69.55189999999999, y: 0 },
    { x: -70.86419999999998, y: 0 },
    { x: -72.17649999999998, y: 0 },
    { x: -73.48879999999997, y: 0 },
    { x: -74.80109999999996, y: 0 },
    { x: -76.11339999999996, y: 0 },
    { x: -77.42569999999995, y: 0 },
    { x: -78.73799999999994, y: 0 },
    { x: -80.05029999999994, y: 0 },
    { x: -81.36259999999993, y: 0 },
    { x: -82.67489999999992, y: 0 },
    { x: -83.98719999999992, y: 0 },
    { x: -85.29949999999991, y: 0 },
    { x: -86.6117999999999, y: 0 },
    { x: -87.9240999999999, y: 0 },
    { x: -89.23639999999989, y: 0 },
    { x: -90.54869999999988, y: 0 },
    { x: -91.86099999999988, y: 0 },
    { x: -93.17329999999987, y: 0 },
    { x: -94.48559999999986, y: 0 },
    { x: -95.79789999999986, y: 0 },
    { x: -97.11019999999985, y: 0 },
    { x: -98.42249999999984, y: 0 },
    { x: -99.73479999999984, y: 0 },
    { x: -101.04709999999983, y: 0 },
    { x: -102.35939999999982, y: 0 },
    { x: -103.67169999999982, y: 0 },
    { x: -104.98399999999981, y: 0 },
    { x: -106.2962999999998, y: 0 },
    { x: -107.6085999999998, y: 0 },
    { x: -108.92089999999979, y: 0 },
    { x: -110.23319999999978, y: 0 },
    { x: -111.54549999999978, y: 0 },
    { x: -112.85779999999977, y: 0 },
    { x: -114.17009999999976, y: 0 },
    { x: -115.48239999999976, y: 0 },
    { x: -116.79469999999975, y: 0 },
    { x: -118.10699999999974, y: 0 },
    { x: -119.41929999999974, y: 0 },
    { x: -120.73159999999973, y: 0 },
    { x: -122.04389999999972, y: 0 },
    { x: -123.35619999999972, y: 0 },
    { x: -124.66849999999971, y: 0 },
    { x: -125.9807999999997, y: 0 },
    { x: -127.2930999999997, y: 0 },
    { x: -130.08247794618094, y: 0.6789908704934081 },
    { x: -130.93692217686836, y: 1.6750111246273127 },
    { x: -131.79136640755578, y: 2.671031378761217 },
    { x: -132.6458106382432, y: 3.667051632895122 },
    { x: -133.50025486893063, y: 4.663071887029027 },
    { x: -134.35469909961805, y: 5.659092141162931 },
    { x: -135.20914333030547, y: 6.655112395296836 },
    { x: -136.0635875609929, y: 7.651132649430741 },
    { x: -136.9180317916803, y: 8.647152903564645 },
    { x: -137.77247602236773, y: 9.64317315769855 },
    { x: -138.62692025305515, y: 10.639193411832455 },
    { x: -139.48136448374257, y: 11.63521366596636 },
    { x: -140.33580871443, y: 12.631233920100264 },
    { x: -141.1902529451174, y: 13.627254174234169 },
    { x: -142.04469717580483, y: 14.623274428368074 },
    { x: -142.89914140649225, y: 15.619294682501978 },
    { x: -143.75358563717967, y: 16.615314936635883 },
    { x: -144.6080298678671, y: 17.611335190769786 },
    { x: -145.4624740985545, y: 18.60735544490369 },
    { x: -146.31691832924193, y: 19.603375699037592 },
    { x: -147.17136255992935, y: 20.599395953171495 },
    { x: -148.02580679061677, y: 21.595416207305398 },
    { x: -148.8802510213042, y: 22.5914364614393 },
    { x: -149.7346952519916, y: 23.587456715573204 },
    { x: -150.58913948267903, y: 24.583476969707107 },
    { x: -151.44358371336645, y: 25.57949722384101 },
    { x: -152.29802794405387, y: 26.575517477974913 },
    { x: -153.1524721747413, y: 27.571537732108816 },
    { x: -154.0069164054287, y: 28.56755798624272 },
    { x: -154.86136063611613, y: 29.56357824037662 },
    { x: -155.71580486680355, y: 30.559598494510524 },
    { x: -156.57024909749097, y: 31.555618748644427 },
    { x: -157.4246933281784, y: 32.55163900277833 },
    { x: -158.2791375588658, y: 33.54765925691223 },
    { x: -159.13358178955323, y: 34.543679511046136 },
    { x: -159.98802602024065, y: 35.53969976518004 },
    { x: -160.84247025092807, y: 36.53572001931394 },
    { x: -161.6969144816155, y: 37.531740273447845 },
    { x: -162.5513587123029, y: 38.52776052758175 },
    { x: -163.40580294299033, y: 39.52378078171565 },
    { x: -164.26024717367775, y: 40.519801035849554 },
    { x: -165.11469140436517, y: 41.51582128998346 },
    { x: -165.9691356350526, y: 42.51184154411736 },
    { x: -166.82357986574002, y: 43.50786179825126 },
    { x: -167.67802409642744, y: 44.503882052385165 },
    { x: -168.53246832711486, y: 45.49990230651907 },
    { x: -169.38691255780228, y: 46.49592256065297 },
    { x: -170.2413567884897, y: 47.491942814786874 },
    { x: -171.09580101917712, y: 48.48796306892078 },
    { x: -171.95024524986454, y: 49.48398332305468 },
  ],
  [
    { x: 0, y: 0 },
    { x: 0, y: 1.3123 },
    { x: 0, y: 2.6246 },
    { x: 0, y: 3.9369 },
    { x: 0, y: 5.2492 },
    { x: 0, y: 6.5615000000000006 },
    { x: 0, y: 7.873800000000001 },
    { x: 0, y: 9.186100000000001 },
    { x: 0, y: 10.498400000000002 },
    { x: 0, y: 11.810700000000002 },
    { x: 0, y: 13.123000000000003 },
    { x: 0, y: 14.435300000000003 },
    { x: 0, y: 15.747600000000004 },
    { x: 0, y: 17.059900000000003 },
    { x: 0, y: 18.372200000000003 },
    { x: 0, y: 19.684500000000003 },
    { x: 0, y: 20.996800000000004 },
    { x: 0, y: 22.309100000000004 },
    { x: 0, y: 23.621400000000005 },
    { x: 0, y: 24.933700000000005 },
    { x: 0, y: 26.246000000000006 },
    { x: 0, y: 27.558300000000006 },
    { x: 0, y: 28.870600000000007 },
    { x: 0, y: 30.182900000000007 },
    { x: 0, y: 31.495200000000008 },
    { x: 0, y: 32.807500000000005 },
    { x: 0, y: 34.119800000000005 },
    { x: 0, y: 35.432100000000005 },
    { x: 0, y: 36.744400000000006 },
    { x: 0, y: 38.056700000000006 },
    { x: 0, y: 39.36900000000001 },
    { x: 0, y: 40.68130000000001 },
    { x: 0, y: 41.99360000000001 },
    { x: 0, y: 43.30590000000001 },
    { x: 0, y: 44.61820000000001 },
    { x: 0, y: 45.93050000000001 },
    { x: 0, y: 47.24280000000001 },
    { x: 0, y: 48.55510000000001 },
    { x: 0, y: 49.86740000000001 },
    { x: 0, y: 51.17970000000001 },
    { x: 0, y: 52.49200000000001 },
    { x: 0, y: 53.80430000000001 },
    { x: 0, y: 55.11660000000001 },
    { x: 0, y: 56.42890000000001 },
    { x: 0, y: 57.74120000000001 },
    { x: 0, y: 59.053500000000014 },
    { x: 0, y: 60.365800000000014 },
    { x: 0, y: 61.678100000000015 },
    { x: 0, y: 62.990400000000015 },
    { x: 0, y: 64.30270000000002 },
    { x: 0, y: 65.61500000000001 },
    { x: 0, y: 66.9273 },
    { x: 0, y: 68.2396 },
    { x: 0.4481000000000108, y: 70 },
    { x: 1.7604000000000108, y: 70 },
    { x: 3.072700000000011, y: 70 },
    { x: 4.3850000000000104, y: 70 },
    { x: 5.697300000000011, y: 70 },
    { x: 7.009600000000011, y: 70 },
    { x: 8.321900000000012, y: 70 },
    { x: 9.634200000000012, y: 70 },
    { x: 10.946500000000013, y: 70 },
    { x: 13, y: 70.74119999999999 },
    { x: 13, y: 72.05349999999999 },
    { x: 13, y: 73.36579999999998 },
    { x: 13, y: 74.67809999999997 },
    { x: 13, y: 75.99039999999997 },
    { x: 13, y: 77.30269999999996 },
    { x: 13, y: 78.61499999999995 },
    { x: 13, y: 79.92729999999995 },
    { x: 13, y: 81.23959999999994 },
    { x: 13, y: 82.55189999999993 },
    { x: 13, y: 83.86419999999993 },
    { x: 13, y: 85.17649999999992 },
    { x: 13, y: 86.48879999999991 },
    { x: 13, y: 87.8010999999999 },
    { x: 13, y: 89.1133999999999 },
    { x: 13, y: 90.42569999999989 },
    { x: 13, y: 91.73799999999989 },
    { x: 13, y: 93.05029999999988 },
    { x: 13, y: 94.36259999999987 },
    { x: 13, y: 95.67489999999987 },
    { x: 13, y: 96.98719999999986 },
    { x: 13, y: 98.29949999999985 },
    { x: 13, y: 99.61179999999985 },
    { x: 13, y: 100.92409999999984 },
    { x: 13, y: 102.23639999999983 },
    { x: 13, y: 103.54869999999983 },
    { x: 13, y: 104.86099999999982 },
    { x: 13, y: 106.17329999999981 },
    { x: 13, y: 107.4855999999998 },
    { x: 13, y: 108.7978999999998 },
    { x: 13, y: 110.1101999999998 },
    { x: 13, y: 111.42249999999979 },
    { x: 12.48479999999978, y: 113.25 },
    { x: 11.17249999999978, y: 113.25 },
    { x: 9.860199999999779, y: 113.25 },
    { x: 8.547899999999778, y: 113.25 },
    { x: 7.235599999999778, y: 113.25 },
    { x: 5.923299999999777, y: 113.25 },
    { x: 4.610999999999777, y: 113.25 },
    { x: 3.298699999999777, y: 113.25 },
    { x: 1.9863999999997768, y: 113.25 },
    { x: 0, y: 113.92409999999978 },
    { x: 0, y: 115.23639999999978 },
    { x: 0, y: 116.54869999999977 },
    { x: 0, y: 117.86099999999976 },
    { x: 0, y: 119.17329999999976 },
    { x: 0, y: 120.48559999999975 },
    { x: 0, y: 121.79789999999974 },
    { x: 0, y: 123.11019999999974 },
    { x: 0, y: 124.42249999999973 },
    { x: 0, y: 125.73479999999972 },
    { x: 0, y: 127.04709999999972 },
    { x: 0, y: 128.3593999999997 },
    { x: 0, y: 129.6716999999997 },
    { x: 0, y: 130.9839999999997 },
    { x: 0, y: 132.2962999999997 },
    { x: 0, y: 133.60859999999968 },
    { x: 0, y: 134.92089999999968 },
    { x: 0, y: 136.23319999999967 },
    { x: 0, y: 137.54549999999966 },
    { x: 0, y: 138.85779999999966 },
    { x: 0, y: 140.17009999999965 },
    { x: 0, y: 141.48239999999964 },
    { x: 0, y: 142.79469999999964 },
    { x: 0, y: 144.10699999999963 },
    { x: 0, y: 145.41929999999962 },
    { x: 0, y: 146.73159999999962 },
    { x: 0, y: 148.0438999999996 },
    { x: 0, y: 149.3561999999996 },
    { x: 0, y: 150.6684999999996 },
    { x: 0, y: 151.9807999999996 },
    { x: 0, y: 153.29309999999958 },
    { x: 0, y: 154.60539999999958 },
    { x: 0, y: 155.91769999999957 },
    { x: 0, y: 157.22999999999956 },
    { x: 0, y: 158.54229999999956 },
    { x: 0, y: 159.85459999999955 },
    { x: 0, y: 161.16689999999954 },
    { x: 0, y: 162.47919999999954 },
    { x: 0, y: 163.79149999999953 },
    { x: 0, y: 165.10379999999952 },
    { x: 0, y: 166.41609999999952 },
    { x: 0, y: 167.7283999999995 },
    { x: 0, y: 169.0406999999995 },
  ],
  [
    { x: -174.751381, y: 183.75 },
    { x: -174.751381, y: 182.4377 },
    { x: -174.751381, y: 181.1254 },
    { x: -174.751381, y: 179.81310000000002 },
    { x: -174.751381, y: 178.50080000000003 },
    { x: -174.751381, y: 177.18850000000003 },
    { x: -174.751381, y: 175.87620000000004 },
    { x: -174.751381, y: 174.56390000000005 },
    { x: -174.751381, y: 173.25160000000005 },
    { x: -174.751381, y: 171.93930000000006 },
    { x: -174.751381, y: 170.62700000000007 },
    { x: -174.751381, y: 169.31470000000007 },
    { x: -174.751381, y: 168.00240000000008 },
    { x: -174.751381, y: 166.6901000000001 },
    { x: -174.751381, y: 165.3778000000001 },
    { x: -174.751381, y: 164.0655000000001 },
    { x: -174.751381, y: 162.7532000000001 },
    { x: -174.751381, y: 161.4409000000001 },
    { x: -174.751381, y: 160.12860000000012 },
    { x: -174.751381, y: 158.81630000000013 },
    { x: -174.751381, y: 157.50400000000013 },
    { x: -174.751381, y: 156.19170000000014 },
    { x: -174.751381, y: 154.87940000000015 },
    { x: -174.751381, y: 153.56710000000015 },
    { x: -174.751381, y: 152.25480000000016 },
    { x: -174.751381, y: 150.94250000000017 },
    { x: -174.751381, y: 149.63020000000017 },
    { x: -174.751381, y: 148.31790000000018 },
    { x: -174.751381, y: 147.0056000000002 },
    { x: -174.751381, y: 145.6933000000002 },
    { x: -174.751381, y: 144.3810000000002 },
    { x: -174.751381, y: 143.0687000000002 },
    { x: -174.751381, y: 141.7564000000002 },
    { x: -174.751381, y: 140.44410000000022 },
    { x: -174.751381, y: 139.13180000000023 },
    { x: -174.751381, y: 137.81950000000023 },
    { x: -174.751381, y: 136.50720000000024 },
    { x: -174.751381, y: 135.19490000000025 },
    { x: -174.751381, y: 133.88260000000025 },
    { x: -174.751381, y: 132.57030000000026 },
    { x: -174.751381, y: 131.25800000000027 },
    { x: -174.751381, y: 129.94570000000027 },
    { x: -174.751381, y: 128.63340000000028 },
    { x: -174.751381, y: 127.32110000000029 },
    { x: -174.751381, y: 126.00880000000029 },
    { x: -174.751381, y: 124.6965000000003 },
    { x: -174.751381, y: 123.3842000000003 },
    { x: -174.751381, y: 122.07190000000031 },
    { x: -174.751381, y: 120.75960000000032 },
    { x: -174.751381, y: 119.44730000000033 },
    { x: -174.751381, y: 118.13500000000033 },
    { x: -174.751381, y: 116.82270000000034 },
    { x: -174.751381, y: 115.51040000000035 },
    { x: -174.751381, y: 114.19810000000035 },
    { x: -174.751381, y: 112.88580000000036 },
    { x: -174.751381, y: 111.57350000000037 },
    { x: -174.751381, y: 110.26120000000037 },
    { x: -174.751381, y: 108.94890000000038 },
    { x: -174.751381, y: 107.63660000000039 },
    { x: -174.751381, y: 106.32430000000039 },
    { x: -174.751381, y: 105.0120000000004 },
    { x: -174.751381, y: 103.6997000000004 },
    { x: -174.751381, y: 102.38740000000041 },
    { x: -174.751381, y: 101.07510000000042 },
    { x: -174.751381, y: 99.76280000000042 },
    { x: -174.751381, y: 98.45050000000043 },
    { x: -174.751381, y: 97.13820000000044 },
    { x: -174.751381, y: 95.82590000000044 },
    { x: -174.751381, y: 94.51360000000045 },
    { x: -174.751381, y: 93.20130000000046 },
    { x: -174.751381, y: 91.88900000000046 },
    { x: -174.751381, y: 90.57670000000047 },
    { x: -174.751381, y: 89.26440000000048 },
    { x: -174.751381, y: 87.95210000000048 },
    { x: -174.751381, y: 86.63980000000049 },
    { x: -174.751381, y: 85.3275000000005 },
    { x: -174.751381, y: 84.0152000000005 },
    { x: -174.751381, y: 82.70290000000051 },
    { x: -174.751381, y: 81.39060000000052 },
    { x: -174.751381, y: 80.07830000000052 },
    { x: -174.751381, y: 78.76600000000053 },
    { x: -174.751381, y: 77.45370000000054 },
    { x: -174.751381, y: 76.14140000000054 },
    { x: -174.751381, y: 74.82910000000055 },
    { x: -174.751381, y: 73.51680000000056 },
    { x: -174.751381, y: 72.20450000000056 },
    { x: -174.751381, y: 70.89220000000057 },
    { x: -174.751381, y: 69.57990000000058 },
    { x: -174.751381, y: 68.26760000000058 },
    { x: -174.751381, y: 66.95530000000059 },
    { x: -174.751381, y: 65.6430000000006 },
    { x: -174.751381, y: 64.3307000000006 },
    { x: -174.751381, y: 63.018400000000604 },
    { x: -174.751381, y: 61.7061000000006 },
    { x: -174.751381, y: 60.3938000000006 },
    { x: -174.751381, y: 59.0815000000006 },
    { x: -174.751381, y: 57.7692000000006 },
    { x: -174.751381, y: 56.4569000000006 },
    { x: -174.751381, y: 55.1446000000006 },
  ],
  [
    { x: -174.751381, y: 183.75 },
    { x: -173.43908100000002, y: 183.75 },
    { x: -172.12678100000002, y: 183.75 },
    { x: -170.81448100000003, y: 183.75 },
    { x: -169.50218100000004, y: 183.75 },
    { x: -168.18988100000004, y: 183.75 },
    { x: -166.87758100000005, y: 183.75 },
    { x: -165.56528100000006, y: 183.75 },
    { x: -164.25298100000006, y: 183.75 },
    { x: -162.94068100000007, y: 183.75 },
    { x: -161.62838100000008, y: 183.75 },
    { x: -160.31608100000008, y: 183.75 },
    { x: -159.0037810000001, y: 183.75 },
    { x: -157.6914810000001, y: 183.75 },
    { x: -156.3791810000001, y: 183.75 },
    { x: -155.0668810000001, y: 183.75 },
    { x: -153.75458100000012, y: 183.75 },
    { x: -152.44228100000012, y: 183.75 },
    { x: -151.12998100000013, y: 183.75 },
    { x: -149.81768100000014, y: 183.75 },
    { x: -148.50538100000014, y: 183.75 },
    { x: -147.19308100000015, y: 183.75 },
    { x: -145.88078100000016, y: 183.75 },
    { x: -144.56848100000016, y: 183.75 },
    { x: -143.25618100000017, y: 183.75 },
    { x: -141.94388100000018, y: 183.75 },
    { x: -140.63158100000018, y: 183.75 },
    { x: -139.3192810000002, y: 183.75 },
    { x: -138.0069810000002, y: 183.75 },
    { x: -136.6946810000002, y: 183.75 },
    { x: -135.3823810000002, y: 183.75 },
    { x: -134.07008100000021, y: 183.75 },
    { x: -132.75778100000022, y: 183.75 },
    { x: -131.44548100000023, y: 183.75 },
    { x: -130.13318100000023, y: 183.75 },
    { x: -128.82088100000024, y: 183.75 },
    { x: -127.50858100000025, y: 183.75 },
    { x: -126.19628100000025, y: 183.75 },
    { x: -124.88398100000026, y: 183.75 },
    { x: -123.57168100000027, y: 183.75 },
    { x: -122.25938100000027, y: 183.75 },
    { x: -120.94708100000028, y: 183.75 },
    { x: -119.63478100000029, y: 183.75 },
    { x: -118.3224810000003, y: 183.75 },
    { x: -117.0101810000003, y: 183.75 },
    { x: -115.69788100000031, y: 183.75 },
    { x: -114.38558100000031, y: 183.75 },
    { x: -113.07328100000032, y: 183.75 },
    { x: -111.76098100000033, y: 183.75 },
    { x: -110.44868100000033, y: 183.75 },
    { x: -109.13638100000034, y: 183.75 },
    { x: -107.82408100000035, y: 183.75 },
    { x: -106.51178100000035, y: 183.75 },
    { x: -105.19948100000036, y: 183.75 },
    { x: -103.88718100000037, y: 183.75 },
    { x: -102.57488100000037, y: 183.75 },
    { x: -101.26258100000038, y: 183.75 },
    { x: -99.95028100000039, y: 183.75 },
    { x: -98.6379810000004, y: 183.75 },
    { x: -97.3256810000004, y: 183.75 },
    { x: -96.01338100000041, y: 183.75 },
    { x: -94.70108100000041, y: 183.75 },
    { x: -93.38878100000042, y: 183.75 },
    { x: -92.07648100000043, y: 183.75 },
    { x: -90.76418100000043, y: 183.75 },
    { x: -89.45188100000044, y: 183.75 },
    { x: -88.13958100000045, y: 183.75 },
    { x: -86.82728100000045, y: 183.75 },
    { x: -85.51498100000046, y: 183.75 },
    { x: -84.20268100000047, y: 183.75 },
    { x: -82.89038100000047, y: 183.75 },
    { x: -81.57808100000048, y: 183.75 },
    { x: -80.26578100000049, y: 183.75 },
    { x: -78.9534810000005, y: 183.75 },
    { x: -77.6411810000005, y: 183.75 },
    { x: -76.32888100000051, y: 183.75 },
    { x: -75.01658100000051, y: 183.75 },
    { x: -73.70428100000052, y: 183.75 },
    { x: -72.39198100000053, y: 183.75 },
    { x: -71.07968100000053, y: 183.75 },
    { x: -69.76738100000054, y: 183.75 },
    { x: -68.45508100000055, y: 183.75 },
    { x: -67.14278100000055, y: 183.75 },
    { x: -65.83048100000056, y: 183.75 },
    { x: -64.51818100000057, y: 183.75 },
    { x: -63.205881000000566, y: 183.75 },
    { x: -61.893581000000566, y: 183.75 },
    { x: -60.581281000000565, y: 183.75 },
    { x: -59.268981000000565, y: 183.75 },
    { x: -57.956681000000565, y: 183.75 },
    { x: -56.644381000000564, y: 183.75 },
    { x: -55.332081000000564, y: 183.75 },
    { x: -54.01978100000056, y: 183.75 },
    { x: -52.70748100000056, y: 183.75 },
    { x: -51.39518100000056, y: 183.75 },
    { x: -50.08288100000056, y: 183.75 },
    { x: -48.77058100000056, y: 183.75 },
    { x: -47.45828100000056, y: 183.75 },
    { x: -46.14598100000056, y: 183.75 },
    { x: -44.83368100000056, y: 183.75 },
    { x: -43.52138100000056, y: 183.75 },
    { x: -42.20908100000056, y: 183.75 },
    { x: -40.89678100000056, y: 183.75 },
    { x: -39.58448100000056, y: 183.75 },
    { x: -38.27218100000056, y: 183.75 },
    { x: -36.95988100000056, y: 183.75 },
    { x: -35.64758100000056, y: 183.75 },
    { x: -34.335281000000556, y: 183.75 },
    { x: -33.022981000000556, y: 183.75 },
    { x: -31.710681000000555, y: 183.75 },
    { x: -30.398381000000555, y: 183.75 },
    { x: -29.086081000000554, y: 183.75 },
    { x: -27.773781000000554, y: 183.75 },
    { x: -26.461481000000553, y: 183.75 },
    { x: -25.149181000000553, y: 183.75 },
    { x: -23.836881000000552, y: 183.75 },
    { x: -22.524581000000552, y: 183.75 },
    { x: -21.21228100000055, y: 183.75 },
    { x: -19.89998100000055, y: 183.75 },
    { x: -18.58768100000055, y: 183.75 },
    { x: -17.27538100000055, y: 183.75 },
    { x: -15.96308100000055, y: 183.75 },
    { x: -14.65078100000055, y: 183.75 },
    { x: -13.338481000000549, y: 183.75 },
    { x: -12.026181000000548, y: 183.75 },
    { x: -10.713881000000548, y: 183.75 },
    { x: -9.401581000000547, y: 183.75 },
    { x: -8.089281000000547, y: 183.75 },
    { x: -6.776981000000546, y: 183.75 },
    { x: -5.464681000000546, y: 183.75 },
    { x: -4.152381000000545, y: 183.75 },
    { x: -2.8400810000005454, y: 183.75 },
    { x: -1.5277810000005454, y: 183.75 },
    { x: 0, y: 183.53451899999945 },
    { x: 0, y: 182.22221899999946 },
    { x: 0, y: 180.90991899999946 },
    { x: 0, y: 179.59761899999947 },
    { x: 0, y: 178.28531899999948 },
    { x: 0, y: 176.97301899999948 },
    { x: 0, y: 175.6607189999995 },
    { x: 0, y: 174.3484189999995 },
    { x: 0, y: 173.0361189999995 },
  ],
];

// strip order not correct, fix it.
const temp = strips[1];
strips[1] = strips[0];
strips[0] = temp;

let flatStrips: { x: number; y: number }[] = [];
strips.forEach(x => (flatStrips = flatStrips.concat(x)));

const limits = {
  minX: Math.min(...flatStrips.map(x => x.x)),
  maxX: Math.max(...flatStrips.map(x => x.x)),
  minY: Math.min(...flatStrips.map(x => x.y)),
  maxY: Math.max(...flatStrips.map(x => x.y)),
};
console.log('limits', limits);

const ledArea = document.getElementById('ledArea');
if (!ledArea) throw Error('missing led area');

const boxSize = {
  height: ledArea.clientHeight,
  width: ledArea.clientWidth,
};

const mapPosition = (x: number, y: number): { left: string; top: string } => {
  const left = ((x - limits.minX) / (limits.maxX - limits.minX)) * (boxSize.width - 10);
  const top = boxSize.height - 10 - ((y - limits.minY) / (limits.maxY - limits.minY)) * (boxSize.height - 10);
  return { left: `${left}px`, top: `${top}px` };
};
